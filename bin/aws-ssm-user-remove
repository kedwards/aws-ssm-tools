#!/bin/bash

# Wrapper script to remove qp user via aws-ssm-exec
# Usage: 
#   ./aws-ssm-user-remove                    # interactive instance selection
#   ./aws-ssm-user-remove i-0478d2123758ec730  # specific instance
#   ./aws-ssm-user-remove Singleton          # instance by name

set -euo pipefail

USER=qp

# Build the command to execute - must work in a single bash -c invocation
REMOVE_COMMAND="USERNAME=qp; if id \$USERNAME &>/dev/null; then pkill -u \$USERNAME || true; userdel -r \$USERNAME && echo User \$USERNAME and home directory removed; else echo User \$USERNAME does not exist; fi; if [ -f /etc/sudoers.d/user_temp_access ]; then rm -f /etc/sudoers.d/user_temp_access && echo Sudoers file removed; else echo Sudoers file does not exist; fi; echo Cleanup complete for user \$USERNAME"

# Execute via aws-ssm-exec
~/.local/bin/aws-ssm-exec "$REMOVE_COMMAND" "$@"
